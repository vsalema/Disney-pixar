/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/videojs-contrib-hls@5.15.0/es5/videojs-contrib-hls.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_get=function(e,t,r){for(var i=!0;i;){var l=e,s=t,o=r;i=!1,null===l&&(l=Function.prototype);var a=Object.getOwnPropertyDescriptor(l,s);if(void 0!==a){if("value"in a)return a.value;var n=a.get;if(void 0===n)return;return n.call(o)}var u=Object.getPrototypeOf(l);if(null===u)return;e=u,t=s,r=o,i=!0,a=u=void 0}};function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _globalDocument=require("global/document"),_globalDocument2=_interopRequireDefault(_globalDocument),_playlistLoader=require("./playlist-loader"),_playlistLoader2=_interopRequireDefault(_playlistLoader),_playlist=require("./playlist"),_playlist2=_interopRequireDefault(_playlist),_xhr=require("./xhr"),_xhr2=_interopRequireDefault(_xhr),_aesDecrypter=require("aes-decrypter"),_binUtils=require("./bin-utils"),_binUtils2=_interopRequireDefault(_binUtils),_videojsContribMediaSources=require("videojs-contrib-media-sources"),_m3u8Parser=require("m3u8-parser"),_m3u8Parser2=_interopRequireDefault(_m3u8Parser),_videoJs=require("video.js"),_videoJs2=_interopRequireDefault(_videoJs),_masterPlaylistController=require("./master-playlist-controller"),_config=require("./config"),_config2=_interopRequireDefault(_config),_renditionMixin=require("./rendition-mixin"),_renditionMixin2=_interopRequireDefault(_renditionMixin),_globalWindow=require("global/window"),_globalWindow2=_interopRequireDefault(_globalWindow),_playbackWatcher=require("./playback-watcher"),_playbackWatcher2=_interopRequireDefault(_playbackWatcher),_reloadSourceOnError=require("./reload-source-on-error"),_reloadSourceOnError2=_interopRequireDefault(_reloadSourceOnError),_playlistSelectorsJs=require("./playlist-selectors.js"),Hls={PlaylistLoader:_playlistLoader2.default,Playlist:_playlist2.default,Decrypter:_aesDecrypter.Decrypter,AsyncStream:_aesDecrypter.AsyncStream,decrypt:_aesDecrypter.decrypt,utils:_binUtils2.default,STANDARD_PLAYLIST_SELECTOR:_playlistSelectorsJs.lastBandwidthSelector,INITIAL_PLAYLIST_SELECTOR:_playlistSelectorsJs.lowestBitrateCompatibleVariantSelector,comparePlaylistBandwidth:_playlistSelectorsJs.comparePlaylistBandwidth,comparePlaylistResolution:_playlistSelectorsJs.comparePlaylistResolution,xhr:(0,_xhr2.default)()},INITIAL_BANDWIDTH=4194304;["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach((function(e){Object.defineProperty(Hls,e,{get:function(){return _videoJs2.default.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),_config2.default[e]},set:function(t){_videoJs2.default.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),"number"!=typeof t||t<0?_videoJs2.default.log.warn("value of Hls."+e+" must be greater than or equal to 0"):_config2.default[e]=t}})}));var handleHlsMediaChange=function(e,t){for(var r=t.media(),i=-1,l=0;l<e.length;l++)if(e[l].id===r.uri){i=l;break}e.selectedIndex_=i,e.trigger({selectedIndex:i,type:"change"})},handleHlsLoadedMetadata=function(e,t){t.representations().forEach((function(t){e.addQualityLevel(t)})),handleHlsMediaChange(e,t.playlists)};Hls.canPlaySource=function(){return _videoJs2.default.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")},Hls.supportsNativeHls=function(){var e=_globalDocument2.default.createElement("video");if(!_videoJs2.default.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some((function(t){return/maybe|probably/i.test(e.canPlayType(t))}))}(),Hls.isSupported=function(){return _videoJs2.default.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Component=_videoJs2.default.getComponent("Component"),HlsHandler=function(e){function t(e,r,i){var l=this;if(_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,r,i.hls),r.options_&&r.options_.playerId){var s=(0,_videoJs2.default)(r.options_.playerId);s.hasOwnProperty("hls")||Object.defineProperty(s,"hls",{get:function(){return _videoJs2.default.log.warn("player.hls is deprecated. Use player.tech_.hls instead."),r.trigger({type:"usage",name:"hls-player-access"}),l}})}if(this.tech_=r,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&(r.featuresNativeVideoTracks||r.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");this.on(_globalDocument2.default,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],(function(e){var t=_globalDocument2.default.fullscreenElement||_globalDocument2.default.webkitFullscreenElement||_globalDocument2.default.mozFullScreenElement||_globalDocument2.default.msFullscreenElement;t&&t.contains(l.tech_.el())&&l.masterPlaylistController_.fastQualityChange_()})),this.on(this.tech_,"seeking",(function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())})),this.on(this.tech_,"error",(function(){this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()})),this.on(this.tech_,"play",this.play)}return _inherits(t,Component),_createClass(t,[{key:"setOptions_",value:function(){var e=this;this.options_.withCredentials=this.options_.withCredentials||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===INITIAL_BANDWIDTH,["withCredentials","bandwidth","handleManifestRedirects"].forEach((function(t){void 0!==e.source_[t]&&(e.options_[t]=e.source_[t])})),this.bandwidth=this.options_.bandwidth}},{key:"src",value:function(e){var t=this;e&&(this.setOptions_(),this.options_.url=this.source_.src,this.options_.tech=this.tech_,this.options_.externHls=Hls,this.masterPlaylistController_=new _masterPlaylistController.MasterPlaylistController(this.options_),this.playbackWatcher_=new _playbackWatcher2.default(_videoJs2.default.mergeOptions(this.options_,{seekable:function(){return t.seekable()}})),this.masterPlaylistController_.on("error",(function(){_videoJs2.default.players[t.tech_.options_.playerId].error(t.masterPlaylistController_.error)})),this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):Hls.STANDARD_PLAYLIST_SELECTOR.bind(this),this.masterPlaylistController_.selectInitialPlaylist=Hls.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var e=1/(this.bandwidth||1),t=void 0;return t=this.throughput>0?1/this.throughput:0,Math.floor(1/(e+t))},set:function(){_videoJs2.default.log.error('The "systemBandwidth" property is read-only')}}}),Object.defineProperties(this.stats,{bandwidth:{get:function(){return t.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return t.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return t.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return t.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return t.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return t.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return t.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return t.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.masterPlaylistController_.on("selectedinitialmedia",(function(){(0,_renditionMixin2.default)(t)})),this.on(this.masterPlaylistController_,"progress",(function(){this.tech_.trigger("progress")})),this.on(this.masterPlaylistController_,"firstplay",(function(){this.ignoreNextSeekingEvent_=!0})),this.tech_.ready((function(){return t.setupQualityLevels_()})),this.tech_.el()&&this.tech_.src(_videoJs2.default.URL.createObjectURL(this.masterPlaylistController_.mediaSource)))}},{key:"setupQualityLevels_",value:function(){var e=this,t=_videoJs2.default.players[this.tech_.options_.playerId];t&&t.qualityLevels&&(this.qualityLevels_=t.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",(function(){handleHlsLoadedMetadata(e.qualityLevels_,e)})),this.playlists.on("mediachange",(function(){handleHlsMediaChange(e.qualityLevels_,e.playlists)})))}},{key:"play",value:function(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function(e){this.masterPlaylistController_.setCurrentTime(e)}},{key:"duration",value:function(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),_get(Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}}]),t}(),HlsSourceHandler=function e(t){return{canHandleSource:function(r){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],l=_videoJs2.default.mergeOptions(_videoJs2.default.options,i);return(!l.hls||!l.hls.mode||l.hls.mode===t)&&e.canPlayType(r.type,l)},handleSource:function(e,r){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],l=_videoJs2.default.mergeOptions(_videoJs2.default.options,i,{hls:{mode:t}});return"flash"===t&&r.setTimeout((function(){r.trigger("loadstart")}),1),r.hls=new HlsHandler(e,r,l),r.hls.xhr=(0,_xhr2.default)(),r.hls.src(e.src),r.hls},canPlayType:function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=_videoJs2.default.mergeOptions(_videoJs2.default.options,r);return e.canPlayType(t,i)?"maybe":""}}};HlsSourceHandler.canPlayType=function(e,t){if(_videoJs2.default.browser.IE_VERSION&&_videoJs2.default.browser.IE_VERSION<=10)return!1;return!(!t.hls.overrideNative&&Hls.supportsNativeHls)&&/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i.test(e)},void 0!==_videoJs2.default.MediaSource&&void 0!==_videoJs2.default.URL||(_videoJs2.default.MediaSource=_videojsContribMediaSources.MediaSource,_videoJs2.default.URL=_videojsContribMediaSources.URL);var flashTech=_videoJs2.default.getTech("Flash");_videojsContribMediaSources.MediaSource.supportsNativeMediaSources()&&_videoJs2.default.getTech("Html5").registerSourceHandler(HlsSourceHandler("html5"),0),_globalWindow2.default.Uint8Array&&flashTech&&flashTech.registerSourceHandler(HlsSourceHandler("flash")),_videoJs2.default.HlsHandler=HlsHandler,_videoJs2.default.HlsSourceHandler=HlsSourceHandler,_videoJs2.default.Hls=Hls,_videoJs2.default.use||_videoJs2.default.registerComponent("Hls",Hls),_videoJs2.default.m3u8=_m3u8Parser2.default,_videoJs2.default.options.hls=_videoJs2.default.options.hls||{},_videoJs2.default.registerPlugin?_videoJs2.default.registerPlugin("reloadSourceOnError",_reloadSourceOnError2.default):_videoJs2.default.plugin("reloadSourceOnError",_reloadSourceOnError2.default),module.exports={Hls:Hls,HlsHandler:HlsHandler,HlsSourceHandler:HlsSourceHandler};
//# sourceMappingURL=/sm/edc54f459f697e923badc255a3179897b0c5cc9ec3d605772ab1499da5a5621a.map